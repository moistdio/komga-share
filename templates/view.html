<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
		img {
			height: 100vw;
			width: 100vw;
			object-fit: cover;
			margin-bottom: 20px;
			box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
		}
    </style>
</head>
<body>
<div id="imageContainer"></div>

<button onclick="previousPage()">Vorherige</button>
<button onclick="nextPage()">NÃ¤chste</button>

<select id="fitSelect" onchange="changeFitMode(this.value)">
    <option value="cover">Cover</option>
    <option value="contain">Contain</option>
    <option value="fill">Fill</option>
    <option value="none">None</option>
    <option value="scale-down">Scale-down</option>
</select>

<script>
    var images = {{ images|tojson|safe }};
    var perPage = 1;
    var currentPage = 1;

	function showPage(page) {
		// Calculate the start and end indices for this page
		var start = (page - 1) * perPage;
		var end = start + perPage;

		// Get the images for this page
		var pageImages = images.slice(start, end);

		// Clear the current images
		var container = document.getElementById('imageContainer');
		container.innerHTML = '';

		// Get the saved mode
		var savedMode = localStorage.getItem('fitMode');

		// Add the images for this page
		for (var i = 0; i < pageImages.length; i++) {
			var img = document.createElement('img');
			img.src = "{{ url_for('static', filename=user_dir) }}/" + pageImages[i];
			// Set the object-fit property to the saved mode
			if (savedMode) {
				img.style.objectFit = savedMode;
			}

			// Add an error event listener to the image
			img.onerror = function() {
				// Replace the page content with an error message
				document.body.innerHTML = 'Content got removed';
			};

			container.appendChild(img);
		}

		// Update the current page
		currentPage = page;

		// Scroll to the top of the page
		window.scrollTo(0, 0);
	}

    function previousPage() {
        if (currentPage > 1) {
            showPage(currentPage - 1);
        }
    }

    function nextPage() {
        if (currentPage < images.length / perPage) {
            showPage(currentPage + 1);
        }
    }

	function changeFitMode(mode) {
		var imgs = document.getElementsByTagName('img');
		for (var i = 0; i < imgs.length; i++) {
			imgs[i].style.objectFit = mode;
		}
		// Save the selected mode to localStorage
		localStorage.setItem('fitMode', mode);
	}

	// Add a keydown event listener to the window
	window.addEventListener('keydown', function(event) {
        // Check which key was pressed
        switch (event.key) {
            case 'ArrowLeft':
                // If the left arrow key was pressed, go to the previous page
                previousPage();
                break;
            case 'ArrowRight':
                // If the right arrow key was pressed, go to the next page
                nextPage();
                break;
        }
    });

	// Restore the selected mode when the page loads
	window.onload = function() {
		showPage(1);
		var savedMode = localStorage.getItem('fitMode');
		if (savedMode) {
			document.getElementById('fitSelect').value = savedMode;
			changeFitMode(savedMode);
		}
	};

	// Gesture support
	var touchStartX = null;

	// Add touch event listeners to the window
	window.addEventListener('touchstart', function(event) {
		touchStartX = event.touches[0].clientX;
	});

	window.addEventListener('touchmove', function(event) {
		if (touchStartX === null) {
			return;
		}
		var touchEndX = event.touches[0].clientX;
		var touchDiff = touchStartX - touchEndX;

		if (touchDiff > 100) { // a left swipe
			nextPage();
			touchStartX = null;
		} else if (touchDiff < -100) { // a right swipe
			previousPage();
			touchStartX = null;
		}
	});

	window.addEventListener('touchend', function(event) {
		touchStartX = null;
	});
</script>
</body>
</html>